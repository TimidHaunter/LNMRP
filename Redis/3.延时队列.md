使用list数据结构构建延时消息队列。lpush和rpush操作入列，rpop和lpop操作出列。



但是消息队列空了咋办？

客户端会不停的pop数据。队列没数据，再pop



解决方案：

1.睡眠，隔一段时间pop一次

2.blpop、brpop，阻塞读，阻塞读在队列没有数据的时候，会立即进入休眠状态，一旦数据到来，则立刻醒过来。消息的延迟几乎为零。



```shell
##入列三个数据
127.0.0.1:6379[1]> rpush notify-queue apple banana pear
(integer) 3
127.0.0.1:6379[1]>
127.0.0.1:6379[1]>
127.0.0.1:6379[1]>
##从左边出列队列
127.0.0.1:6379[1]> lpop notify-queue
"apple"
##从左边出列队列
127.0.0.1:6379[1]> lpop notify-queue
"banana"
##从左边出列队列
127.0.0.1:6379[1]> lpop notify-queue
"pear"
##从左边出列队列，已经没有数据了
127.0.0.1:6379[1]> lpop notify-queue
(nil)
##如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止
127.0.0.1:6379[1]> blpop notify-queue 100
1) "notify-queue"
2) "mango"
(64.66s)

##超时，延时0.06出列
127.0.0.1:6379[1]> blpop notify-queue 1
(nil)
(1.06s)

##这是入列一个数据
127.0.0.1:6379[1]> rpush notify-queue mango
(integer) 1
```



空闲自动断开

服务器主动断开阻塞的线程。客户端要捕获异常，重试。



